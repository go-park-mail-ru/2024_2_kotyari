## Функциональные зависимости и нормальные формы (Расширенные объяснения)

### **Таблица: users**

**Функциональные зависимости:**

- `{id} -> email, username, city, age, avatar_url, password, blocked, blocked_until, created_at, updated_at`
- `{email} -> id, username, city, age, avatar_url, password, blocked, blocked_until, created_at, updated_at`
- `{username} -> id, email, city, age, avatar_url, password, blocked, blocked_until, created_at, updated_at`

**Объяснение нормализации:**

- **Первая нормальная форма (1НФ):**

  Таблица `users` находится в 1НФ, так как все ее атрибуты атомарны (неделимы), и каждый атрибут содержит одно значение для каждой записи.

- **Вторая нормальная форма (2НФ):**

  Таблица находится в 2НФ, если она находится в 1НФ и каждый неключевой атрибут полностью зависит от первичного ключа.

  В данном случае, первичный ключ — `id`. Все остальные атрибуты функционально зависят от `id`. Нет частичных зависимостей, так как первичный ключ простой (не составной).

- **Третья нормальная форма (3НФ):**

  Таблица находится в 3НФ, если она находится в 2НФ и у нее нет транзитивных зависимостей.

  Проверим на наличие транзитивных зависимостей: если существует зависимость вида `A -> B -> C`, то необходимо устранить это.

  В данной таблице нет атрибутов, которые функционально зависят от других неключевых атрибутов. Все неключевые атрибуты зависят только от первичного ключа `id`.

- **Нормальная форма Бойса-Кодда (НФБК):**

  Таблица находится в НФБК, если для каждой нетривиальной функциональной зависимости `X -> Y` верно, что `X` является суперключом.

  В данном случае, существуют функциональные зависимости `{email} -> ...` и `{username} -> ...`, и `email` и `username` являются уникальными (имеют ограничения UNIQUE), но не являются первичными ключами.

  Однако, так как `email` и `username` уникальны, они являются кандидатами в ключи. Поэтому все детерминанты являются ключами или кандидатными ключами, что соответствует НФБК.

### **Таблица: sellers**

**Функциональные зависимости:**

- `{id} -> name, logo, rating, created_at, updated_at`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Все неключевые атрибуты полностью зависят от простого первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей между неключевыми атрибутами.

- **НФБК:**

  Единственный детерминант `id` является суперключом. НФБК соблюдается.

### **Таблица: products**

**Функциональные зависимости:**

- `{id} -> seller_id, count, price, original_price, discount, title, description, rating, image_url, active, created_at, updated_at`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Все неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей между неключевыми атрибутами. Например, `price` не зависит от `discount`; они оба зависят только от `id`.

- **НФБК:**

  Единственная функциональная зависимость — от первичного ключа `id`. Поэтому все детерминанты являются суперключами, что соответствует НФБК.

### **Таблица: product_characteristics**

**Функциональные зависимости:**

- `{product_id, characteristic_id} -> value`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Первичный ключ составной: `(product_id, characteristic_id)`. Атрибут `value` полностью зависит от обоих атрибутов ключа.

  Если бы `value` зависел только от одного из них, это нарушало бы 2НФ.

- **3НФ:**

  Нет транзитивных зависимостей. Нет других неключевых атрибутов, от которых бы зависели другие атрибуты.

- **НФБК:**

  Все детерминанты являются суперключами. В данном случае, детерминант `(product_id, characteristic_id)` является первичным ключом.

### **Таблица: options**

**Функциональные зависимости:**

- `{id} -> name`
- `{name} -> id`

**Объяснение нормализации:**

- **1НФ:**

  Атрибуты атомарны.

- **2НФ:**

  Неключевой атрибут `name` зависит от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `name` являются кандидатами в ключи (так как `name` уникален). Поэтому НФБК соблюдается.

### **Таблица: product_options**

**Функциональные зависимости:**

- `{id} -> product_id, option_id`
- `{product_id, option_id} -> id`

**Объяснение нормализации:**

- **1НФ:**

  Атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `(product_id, option_id)` являются кандидатами в ключи (уникальные пары), поэтому НФБК соблюдается.

### **Таблица: product_option_values**

**Функциональные зависимости:**

- `{id} -> product_option_id, value, link`
- `{product_option_id, value} -> id, link`

**Объяснение нормализации:**

- **1НФ:**

  Атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Проверяем транзитивные зависимости. Если `link` зависит от `value`, то это могло бы нарушить 3НФ. Предполагается, что `link` зависит от комбинации `product_option_id` и `value`.

- **НФБК:**

  Детерминанты `id` и `(product_option_id, value)` являются кандидатами в ключи (уникальны по определению), поэтому НФБК соблюдается.

### **Таблица: favorites**

**Функциональные зависимости:**

- `{id} -> user_id, product_id, created_at`
- `{user_id, product_id} -> id, created_at`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Все неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `(user_id, product_id)` являются кандидатами в ключи (так как комбинация уникальна), поэтому НФБК соблюдается.

### **Таблица: product_images**

**Функциональные зависимости:**

- `{id} -> product_id, image_url, created_at`
- `{product_id, image_url} -> id, created_at`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `(product_id, image_url)` являются кандидатами в ключи, поэтому НФБК соблюдается.

### **Таблица: stock_address**

**Функциональные зависимости:**

- `{id} -> address, city, country, postal_code`
- `{address, city, country, postal_code} -> id`

**Объяснение нормализации:**

- **1НФ:**

  Атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `(address, city, country, postal_code)` являются кандидатами в ключи (уникальны), поэтому НФБК соблюдается.

### **Таблица: orders**

**Функциональные зависимости:**

- `{id} -> user_id, address, stock_address_id, total_price, status, created_at, updated_at`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Все неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей между неключевыми атрибутами.

- **НФБК:**

  Единственный детерминант `id` является суперключом. НФБК соблюдается.

### **Таблица: product_orders**

**Функциональные зависимости:**

- `{id} -> order_id, product_id, option_value_id, count, delivery_date`
- `{order_id, product_id, option_value_id} -> count, delivery_date`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

  Однако, `count` и `delivery_date` функционально зависят от комбинации `(order_id, product_id, option_value_id)`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Так как комбинация `(order_id, product_id, option_value_id)` уникальна (есть ограничение UNIQUE), она является кандидатом в ключи, и НФБК соблюдается.

### **Таблица: carts**

**Функциональные зависимости:**

- `{id} -> user_id, product_id, option_value_id, count, is_selected, created_at, updated_at, delivery_date`
- `{user_id, product_id, option_value_id} -> count, is_selected, created_at, updated_at, delivery_date`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Неключевые атрибуты зависят от первичного ключа `id`.

  Также, `count`, `is_selected`, `created_at`, `updated_at`, `delivery_date` функционально зависят от комбинации `(user_id, product_id, option_value_id)`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Комбинация `(user_id, product_id, option_value_id)` является кандидатом в ключи (ограничение UNIQUE), поэтому НФБК соблюдается.

### **Таблица: categories**

**Функциональные зависимости:**

- `{id} -> name, picture, active, link_to`
- `{name} -> id, picture, active, link_to`

**Объяснение нормализации:**

- **1НФ:**

  Атрибуты атомарны.

- **2НФ:**

  Все неключевые атрибуты зависят от первичного ключа `id`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Детерминанты `id` и `name` являются кандидатами в ключи (так как `name` уникален), поэтому НФБК соблюдается.

### **Таблица: product_categories**

**Функциональные зависимости:**

- `{id} -> product_id, category_id, active`
- `{product_id, category_id} -> active`

**Объяснение нормализации:**

- **1НФ:**

  Все атрибуты атомарны.

- **2НФ:**

  Неключевой атрибут `active` зависит от первичного ключа `id`.

  Также, `active` зависит от комбинации `(product_id, category_id)`.

- **3НФ:**

  Нет транзитивных зависимостей.

- **НФБК:**

  Комбинация `(product_id, category_id)` является кандидатом в ключи (ограничение UNIQUE), поэтому НФБК соблюдается.
